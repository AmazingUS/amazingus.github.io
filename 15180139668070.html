<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
     Docker使用教程 - TIME TO GO 
  </title>
   
  <link href="atom.xml" rel="alternate" title="TIME TO GO" type="application/atom+xml">
  <link rel="stylesheet" href="asset/css/foundation.min.css" />
  <link rel="stylesheet" href="asset/css/docs.css" />
  <script src="asset/js/vendor/modernizr.js"></script>
  <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
  <script type="text/javascript">
    function before_search() {
      var searchVal = 'site: ' + document.getElementById('search_input').value;
      document.getElementById('search_q').value = searchVal;
      return true;
    }
  </script>
</head>

<body class="antialiased hide-extras">
  <div class="marketing off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">


      <nav class="top-bar docs-bar hide-for-small" data-topbar>
        <section class="top-bar-section">
          <div class="row">
            <div style="position: relative;width:100%;">
              <div style="position: absolute; width:100%;">
                <ul id="main-menu" class="left">
                  
                  <li id="">
                    <a target="self" href="index.html">Home</a>
                  </li>
                  
                  <li id="">
                    <a target="_self" href="archives.html">Archives</a>
                  </li>
                  
                </ul>
                <ul class="right" id="search-wrap">
                  <li>
                    <form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
                      <input type="hidden" id="search_q" name="q" value="" />
                      <input tabindex="1" type="search" id="search_input" placeholder="Search" />
                    </form>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </nav>

      <nav class="tab-bar show-for-small">
        <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
          <span> &nbsp; TIME TO GO</span>
        </a>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li>
            <a href="index.html">HOME</a>
          </li>
          <li>
            <a href="archives.html">Archives</a>
          </li>
          <li>
            <a href="about.html">ABOUT</a>
          </li>
          <li>
            <label>Categories</label>
          </li>
          
        </ul>
      </aside>
      <a class="exit-off-canvas" href="#"></a>
      <section id="main-content" role="main" class="scroll-container"> <script type="text/javascript">
  $(function () {
    $('#menu_item_index').addClass('is_active');
    $('#sidebar').parent().parent().hide();
  });
</script>

<div class="row">
  <div class="large-12 medium-12 columns">
    <div class="markdown-body article-wrap">

      <div class="article">
        
        <h1>Docker使用教程</h1>
        <div class="read-more clearfix">
          <span class="date">2018/2/7</span>
           
          <span class="comments">
             
          </span>
        </div>
      </div>

      <div class="article-content">
        <ul>
<li>
<a href="#toc_0">一、概述</a>
</li>
<li>
<a href="#toc_1">二、原理</a>
</li>
<li>
<a href="#toc_2">三、安装</a>
</li>
<li>
<a href="#toc_3">四、简单案例</a>
</li>
<li>
<a href="#toc_4">五、常见命令</a>
</li>
</ul>


<span id="more"></span><!-- more -->

<h4 id="toc_0">一、概述</h4>

<ul>
<li><p><strong>Docker是一个开源的应用容器引擎，其类似于传统的虚拟机，但是比传统的虚拟机更加轻量级；</strong></p>

<ul>
<li>编程语言有平台依赖的（如C/C++）、跨平台的（如Java），软件部署也是依赖平台的；Docker使用容器引擎解决了软件部署的平台依赖性，屏蔽了具体平台相关信息，对上层应用（软件）提供了统一的接口；</li>
<li>类似于Android的App有应用市场，Docker也提供了相关应用的管理市场（镜像仓库；它的应用是以镜像的形式发布的）；</li>
<li>使用Docker部署的应用也可以具有类型Git的版本控制功能，可以对应用做一些修改、提交，在多个版本间进行版本快速切换；</li>
<li><strong>综上：Docker是用来管理软件部署的，其把应用打包成一个个镜像，镜像带有版本控制功能，镜像也可以发布发布到镜像仓库分享给别人使用；</strong></li>
</ul></li>
<li><p>通过Docker可以解决以下痛点：重新搭建相同的开发环境、测试时开发环境和测试环境不一致、服务器部署复迁移等；</p></li>
<li><p>Docker是一个C/S的架构；Docker Daemon（Server端）在宿主主机上以后台守护进程的形式运行，接收并执行指令，Docker Client使用比较灵活，既可以在本机上以bin命令的形式发送指令，也可以在远端通过RESTful API的形式发送指令；</p>

<ul>
<li>假设要启动一个Docker应用appx：a. Client向Daemon发送启动appx命令；b. 若没有appx相关应用，则Daemon就请求Docker的镜像仓库搜索并下载appx；c. 之后Daemon启动appx应用，并将启动结果返回给Client；</li>
</ul></li>
</ul>

<h4 id="toc_1">二、原理</h4>

<ul>
<li><p>Docker把软件和其依赖的环境（操作系统、共享库等）、依赖的配置文件打包在一起，以虚拟机的形式供大家使用，这样就解决了软件安装部署没有统一标准的问题；</p></li>
<li><p>为了解决多个打包中可能存在相同的依赖（如操作系统），Docker引入了分层的概念，将一个应用分为多个层；比如操作系统是第一层，依赖库和第三方软件是第二层，应用的软件包和配置文件是第三层等；</p>

<ul>
<li>若两个应用有着相同的底层，就可以共同这些层；比如应用A和应用B都使用相同的操作系统，则安装应用A时需要下载操作系统层，安装应用B就不需要下载了，直接拿来共用；</li>
<li>为了解决共享层存在的冲突问题（比如应用A需要修改操作系统的某个配置，而应用B不需要），规定层是有优先级的，上层优先权比下层高，上下层有相同文件配置时，上层的覆盖下层的；每个应用都有一个优先级高的空白层，若需要修改下层的文件，则会将该文件复制一份到空白层，进行修改保存，从而保存下层的文件不做任何改变；</li>
</ul></li>
<li><p>Docker使用的是以LXC/libcontrainer的内核虚拟化技术（OpenVZ也是的），比传统的虚拟机（KVM、Xen、VMware）更轻量级；</p>

<ul>
<li>Docker把在Docker仓库的的打包文件称为镜像（image），把下载到本地运行可能需要修改的打包文件称为容器（contrainer）；在仓库中的应用都是以镜像形式存在的，把镜像从仓库中下拉到本地，以这个镜像为模板启动应用就叫容器；</li>
</ul></li>
<li><p>Docker的版本控制也是通过分层特性完成增量更新的，不同的版本对应一个层； </p></li>
</ul>

<h4 id="toc_2">三、安装</h4>

<ul>
<li>macOS下的Docker的工具，经历了boot2docker、Docker Toolbox、Docker for Mac（更轻量，使用了xhyve，macOS自带的Hypervisor.framework）；</li>
<li>Docker for Mac有两个版本：Docker CE（社区版）、Docker EE（企业版），一般使用社区版即可；其由以下三大组件构成：

<ul>
<li>Docker Engine：Docker基本核心工具；</li>
<li>Docker Compose：可管理多个Docker容器；</li>
<li>Docker Machine：可管理多个Docker主机，可搭建swarm集群；</li>
</ul></li>
<li><p>安装完成Docker for Mac后，可以在终端中执行相关命令管理docker；</p>

<pre><code># 分别查看三大组件版本
docker --version
docker-compose --version
docker-machine --version

# 启动一个nginx docker容器（名称为webserver，本地访问地址为127.0.0.1:8080
docker run --name webserver -p 8080:80 -d nginx
# 查看正在运行的docker容器
docker ps
docker ps | awk &#39;{print $2, $NF}&#39;
</code></pre></li>
<li><p>为了简化Docker的使用，官方提供了Kitematic图像化工具用于管理Docker镜像、容器；</p></li>
<li><p>若需要进行Docker Engine的多版本管理，可以使用dvm（不能管理Docker Compose、Docker Machine）；</p>

<pre><code>brew install dvm
</code></pre></li>
</ul>

<h4 id="toc_3">四、简单案例</h4>

<ul>
<li><p>1、WordPress安装</p>

<pre><code>docker run --name db --env MYSQL_ROOT_PASSWORD=example -d mariadb

docker run --name MyWorldPress --link db:mysql -p 8080:80 -d wordpress
</code></pre>

<ul>
<li>启动一个mariadb数据库（MYSQL的一个分支），设置管理员的root密码为example，并且让这个数据库运行在后台，并给起一个唯一的名字db进行标识；

<ul>
<li>--name设置名称</li>
<li>--env设置环境变量MYSQL_ROOT_PASSWORD</li>
<li>-d表示后台运行，若无该参数则前台运行</li>
<li>最后的mariadb表示启动的一个mariadb数据库，若当前设备中没有mariadb数据库，就会从Docker Hub中搜索并下载</li>
</ul></li>
<li>WordPree需要和数据库进行连接，通过第一条命令已经启动了mariadb数据库了并命名为db；

<ul>
<li>第二条命令通过--link db:mysql参数把WordPress和数据库建立起连接</li>
<li>通过-p 8080:80把原来服务的80端口映射到8080端口，这样就可以通过8080端口进行访问了</li>
</ul></li>
</ul></li>
<li><p>2、Redmine安装</p>

<pre><code>docker run --name=redmine-postgresql -d \
--env=&#39;DB_NAME=redmine_production&#39; \
--env=&#39;DB_USER=redmine&#39; --env=&#39;DB_PASS=password&#39; \
sameersbn/postgresql

docker run --name=redmine -d \
--link=redmine-postgresql:postgresql --publish=10083:80 \
--env=&#39;REDMINE_PORT=10083&#39; \
sameersbn/redmine
</code></pre>

<ul>
<li>Docker指令中的参数标识符可以重复使用，比如若传递多个环境变量，可以连续使用多个<code>--env</code>；</li>
</ul></li>
<li><p>3、GitLab安装(<code>https://hub.docker.com/r/sameersbn/gitlab/</code>)</p>

<pre><code>// postgresql
docker run --name=gitlab-postgresql -d \
--env=&#39;DB_NAME=gitlab_production&#39; \
--env=&#39;DB_USER=gitlab&#39; --env=&#39;DB_PASS=password&#39; \
--env=&#39;DB_EXTENSION=pg_trgm&#39; \
sameersbn/postgresql

// redis
docker run --name gitlab-redis -d sameersbn/redis

// gitlab
docker run --name gitlab -d \
--link gitlab-postgresql:postgresql --link gitlab-redis:redisio \
--publish 10022:22 --publish 10080:80 \
--env &#39;GITLAB_PORT=10080&#39; --env &#39;GITLAB_SSH_PORT=10022&#39; \
--env &#39;GITLAB_SECRETS_DB_KEY_BASE=long-and-random-alpha-numeric-string&#39; \
--env &#39;GITLAB_SECRETS_SECRET_KEY_BASE=long-and-random-alpha-numeric-string&#39; \
--env &#39;GITLAB_SECRETS_OTP_KEY_BASE=long-and-random-alpha-numeric-string&#39; \
sameersbn/gitlab
</code></pre></li>
</ul>

<h4 id="toc_4">五、常见命令</h4>

<ul>
<li><p>Docker命令基本语法：docker + 命令关键字 + 一系列参数，通过 <code>docker COMMAND --help</code> 查看支持哪些参数；</p>

<ul>
<li>Docker容器的查询、创建、开启、停止：docker ps、docker run</li>
<li>Docker镜像的查询、创建、删除：docker images、docker build</li>
<li>Docker仓库的查询、下载：docker search、docker pull</li>
<li>守护进程的系统资源设置和全局信息获取：docker deamon、docker info</li>
<li>Docker命令还支持嵌套等操作，如：<code>docker rm $（docker ps -a -q)</code> // 删除所有停止运行的容器（慎用）</li>
</ul></li>
<li><p><strong>容器管理</strong></p>

<ul>
<li>每个容器被创建后，都会分配一个CONTAINER ID（128位，docker ps只显示前16位，加--no-trunc参数可显示完全）作为容器的唯一标识，之后对容器的启动、停止、删除、修改等操作，都是通过该ID进行的；</li>
<li>为了简化对容器的操作，在创建容器时加--name参数指定名称，之后就可以通过名称来管理容器；</li>
<li><p>Docker提供了支持在容器执执行指令的命令，使用方式为 <code>docker exec + 容器名 + 容器内执行的命令</code> ；若需要连续执行多条指令，则可以加 <code>-it</code> 参数，就是以root身份登入容器内，执行完成后通过exit退出；</p>

<pre><code>docker ps -a | grep f0f50e177b13
docker start f0f50e177b13
dccker stop f0f50e177b13
docker start mywordpress
docker rm mywordpress

docker inspect mywordpress // 查询容器所有信息（配置、运行信息），JSON格式的
docker inspect -f {{.NetworkSettings.IPAddress}} MyWordPress // 加-f参数提供指定部分的信息

docker logs mywordpress  // 查询日志
docker logs -f mywordpress  // 查询实时（加-f参数）日志

docker stats mywordpress // 查看容器占用系统资源（如CPU、内存等）

docker exec mywordpress uname -a // 在容器内执行查看系统信息指令
# Linux f0f50e177b13 4.9.60-linuxkit-aufs #1 SMP Mon Nov 6 16:00:12 UTC 2017 x86_64 GNU/Linux

// 连续执行多条指令
docker exec -it mywordpress /bin/bash
root@f0f50e177b13:/var/www/html# pwd
/var/www/html
root@f0f50e177b13:/var/www/html# uname -a
Linux f0f50e177b13 4.9.60-linuxkit-aufs #1 SMP Mon Nov 6 16:00:12 UTC 2017 x86_64 GNU/Linux
root@f0f50e177b13:/var/www/html# exit
exit
</code></pre></li>
<li><p>Docker提倡“一个容器一个进程”，若一个服务有多个进程组成就创建多个容器配合使用；多个容器间需要有数据交互可使用 <code>--link</code> 参数进行关联（要注意容器之间的启动顺序），如之前的博客系统，使用两个容器组成（mywordpress、db）；</p></li>
<li><p>为了简化多个容器间启动停止过程，可以使用Docker Compose容器编排工具，其允许使用一个模板（YAML格式文件，后缀名为.yml；默认名称为docker-compose.yml，使用-f参数指定配置文件）定义一组关联的应用容器，之后使用一条docker-compose up命令就可以将多个容器同时启动停止；</p></li>
<li><p>Docker Compose只是简单的根据顺序启动，并不是完全等某个容器启动完毕后再启动后续的容器；</p>

<pre><code>docker-compose up // 创建并启动容器组
docker-compose -f ~/a.yml up // 创建并启动容器组（自定义模块文件名称）
docker-compose down // 关闭并删除容器组
docker-compose start // 启动容器组
docker-compose stop // 关闭容器组
</code></pre>

<pre><code># WordPress
wordpress_2:
  image: wordpress
  links:
    - db_2:mysql
  ports:
    - 8080:80

db_2:
  image: mariadb
  environment:
    MYSQL_ROOT_PASSWORD: example
</code></pre>

<pre><code># GitLab
gitlab-postgresql2:
  image: sameersbn/postgresql
  environment:
    DB_NAME: gitlab_production2
    DB_USER: gitlab
    DB_PASS: password
    DB_EXTENSION: pg_trgm

gitlab-redis2:
  image: sameersbn/redis

gitlab2:
  image: sameersbn/gitlab
  links:
    - gitlab-postgresql2:postgresql
    - gitlab-redis2:redisio
  ports:
    - &quot;10022:22&quot;
    - &quot;10080:80&quot;
  environment:
    GITLAB_PORT: 10080
    GITLAB_SSH_PORT: 10022
    GITLAB_SECRETS_DB_KEY_BASE: long-and-random-alpha-numeric-string
    GITLAB_SECRETS_SECRET_KEY_BASE: long-and-random-alpha-numeric-string
    GITLAB_SECRETS_OTP_KEY_BASE: long-and-random-alpha-numeric-string
</code></pre></li>
</ul></li>
<li><p><strong>镜像管理</strong></p>

<ul>
<li>创建容器时需要指定使用哪个镜像，若本地没有则会自动从Docker Hub仓库中查询并下载；容器创建后是不依赖镜像就可以运行的；删除容器默认是不会删除相应的镜像的；</li>
<li>镜像也有唯一的标识符Image ID，与容器的Container ID类似；</li>
<li>Docker镜像才有了分层机制，相同部分独立成层，以供共用；其有两大特性：已有的分层只能读不能修改、上传镜像的优先级高于底层镜像；</li>
<li>容器时在镜像的基础上创建的，其在分层镜像的基础上增加了一个新的空白分层，这个新分层是可读写的；</li>
<li><p>所有的写操作都会存储在容器的最上面的可读写层，Docker容器可以通过 <code>docker commit</code> 命令来提交生成新镜像（这只是一种方式）；</p>

<pre><code>docker image -a // 查看本地所有镜像
docker history wordpress // 查看镜像分了多少层
</code></pre></li>
<li><p>通过提交生成新镜像，这种方式不利于维护更新大量的Docker镜像；可以使用Dockerfile来管理生成镜像，Dockerfile类似于Linux下的Makefile；</p></li>
</ul></li>
</ul>

      </div>

      <div class="row">
        <div class="large-6 columns">
          <p class="text-left" style="padding:15px 0px;">
            
            <a href="15594138145337.html" title="Previous Post: ObjC、C、C++混编">&laquo; ObjC、C、C++混编</a>
            
          </p>
        </div>
        <div class="large-6 columns">
          <p class="text-right" style="padding:15px 0px;">
            
            <a href="15147939316129.html" title="Next Post: Carthage使用教程">Carthage使用教程 &raquo;</a>
            
          </p>
        </div>
      </div>

      <div class="comments-wrap">
        <div class="share-comments">
            
        </div>
      </div>

    </div>
  </div> <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">

      <div id="site-info" class="site-info">
        
        <h1>TIME TO GO</h1>
        <div class="site-des">It is just a matter of time.</div>
        <div class="social">
                    
          <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
        </div>
      </div>

      

      <div id="site-categories" class="side-item ">
        <div class="side-header">
          <h2>Categories</h2>
        </div>
        <div class="side-content">
          <p class="cat-list">
            
          </p>
        </div>
      </div>

      <div id="site-categories" class="side-item">
        <div class="side-header">
          <h2>Recent Posts</h2>
        </div>
        <div class="side-content">
          <ul class="posts-list">
              <li class="post">
              <a href="15626010144789.html">iOS状态栏</a>
              </li>
                 <li class="post">
              <a href="15622540495294.html">iOS屏幕旋转</a>
              </li>
                 <li class="post">
              <a href="15590636648081.html">OpenCV配置使用</a>
              </li>
                 <li class="post">
              <a href="15590617242967.html">Sublime配置使用</a>
              </li>
                 <li class="post">
              <a href="15580276420967.html">iOS照片框架</a>
              </li>
                                             
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>

</div> <div class="page-bottom clearfix">
  <div class="row">
    <p class="copyright">Copyright &copy; 2015 Powered by
      <a target="_blank" href="">ME</a>
    </p>
  </div>
</div>
</section>

</div>
</div>

 
<script src="asset/js/foundation.min.js"></script>
<script>
  $(document).foundation();
  function fixSidebarHeight() {
    var w1 = $('.markdown-body').height();
    var w2 = $('#sidebar').height();
    if (w1 > w2) { $('#sidebar').height(w1); };
  }
  $(function () {
    fixSidebarHeight();
  })
  $(window).load(function () {
    fixSidebarHeight();
  });
</script>   
</body>

</html>