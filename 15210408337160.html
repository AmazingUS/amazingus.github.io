<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
     iOS静态库、动态库 - TIME TO GO 
  </title>
   
  <link href="atom.xml" rel="alternate" title="TIME TO GO" type="application/atom+xml">
  <link rel="stylesheet" href="asset/css/foundation.min.css" />
  <link rel="stylesheet" href="asset/css/docs.css" />
  <script src="asset/js/vendor/modernizr.js"></script>
  <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
  <script type="text/javascript">
    function before_search() {
      var searchVal = 'site: ' + document.getElementById('search_input').value;
      document.getElementById('search_q').value = searchVal;
      return true;
    }
  </script>
</head>

<body class="antialiased hide-extras">
  <div class="marketing off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">


      <nav class="top-bar docs-bar hide-for-small" data-topbar>
        <section class="top-bar-section">
          <div class="row">
            <div style="position: relative;width:100%;">
              <div style="position: absolute; width:100%;">
                <ul id="main-menu" class="left">
                  
                  <li id="">
                    <a target="self" href="index.html">Home</a>
                  </li>
                  
                  <li id="">
                    <a target="_self" href="archives.html">Archives</a>
                  </li>
                  
                </ul>
                <ul class="right" id="search-wrap">
                  <li>
                    <form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
                      <input type="hidden" id="search_q" name="q" value="" />
                      <input tabindex="1" type="search" id="search_input" placeholder="Search" />
                    </form>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </nav>

      <nav class="tab-bar show-for-small">
        <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
          <span> &nbsp; TIME TO GO</span>
        </a>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li>
            <a href="index.html">HOME</a>
          </li>
          <li>
            <a href="archives.html">Archives</a>
          </li>
          <li>
            <a href="about.html">ABOUT</a>
          </li>
          <li>
            <label>Categories</label>
          </li>
          
        </ul>
      </aside>
      <a class="exit-off-canvas" href="#"></a>
      <section id="main-content" role="main" class="scroll-container"> <script type="text/javascript">
  $(function () {
    $('#menu_item_index').addClass('is_active');
    $('#sidebar').parent().parent().hide();
  });
</script>

<div class="row">
  <div class="large-12 medium-12 columns">
    <div class="markdown-body article-wrap">

      <div class="article">
        
        <h1>iOS静态库、动态库</h1>
        <div class="read-more clearfix">
          <span class="date">2018/3/14</span>
           
          <span class="comments">
             
          </span>
        </div>
      </div>

      <div class="article-content">
        <ul>
<li>
<a href="#toc_0">一、类库分类</a>
</li>
<li>
<a href="#toc_1">二、类库类型支持</a>
</li>
<li>
<a href="#toc_2">三、设备CPU架构</a>
</li>
<li>
<a href="#toc_3">四、资源文件处理</a>
</li>
<li>
<a href="#toc_4">五、补充知识</a>
</li>
</ul>


<h4 id="toc_0">一、类库分类</h4>

<ul>
<li>静态库：

<ul>
<li>.a二进制库：使用时还需要将.h头文件及资源文件（比如图片等）拖入到工程项目中，配置一些header、lib路径之类的；使用起来比较麻烦；</li>
<li>.framework库：Apple平台独有，其本质是将.a库文件、.h头文件及资源文件打包在一起的包文件；使用时直接将其拖到工程项目中即可（或在 <code>Link Binary With Libraries</code> 中添加即可使用）；</li>
</ul></li>
<li>动态库：

<ul>
<li>.tdb库：Xcode 7（iOS9）开始使用，之前名称为.dylib；在 <code>Link Binary With Libraries</code> 中添加即可使用；</li>
<li>.framework库：在 <code>Link Binary With Libraries</code> 中添加即可使用；</li>
</ul></li>
</ul>

<span id="more"></span><!-- more -->

<h4 id="toc_1">二、类库类型支持</h4>

<ul>
<li><p>Xcode 6（iOS8）之前：</p>

<ul>
<li><p>出于安全考虑，Xcode只支持创建.a静态库（注意需要将相关的.h头文件public出来）；不支持创建.framework静态库，但是可以通过第三方工具创建（如iOS-Universal-Framework），这种被称为伪（Fake）Framework；</p></li>
<li><p>一般情况下都使用第三方工具创建.framework静态库，因为这样之后使用起来比.a形式更方便；</p></li>
<li><p>Xcode也不支持创建任何形式的动态库；</p></li>
<li><p>.tdb/.dylib动态库、.framework动态库都是系统内置的（如libz.dylib、UIKit.framework），故开发者只能使用系统内置的动态库；</p>

<p><img src="media/15210408337160/xcode_5.png" alt="xcode_5" style="width:311px;"/></p></li>
</ul></li>
<li><p>Xcode 6（iOS8）开始：</p>

<ul>
<li>Xcode支持创建.a静态库、.framework静态库（修改Mach-O Type，默认为动态库）；</li>
<li><p><strong>Xcode也支持创建.framework动态库了，但这是一种特殊的动态库（使用时需要被添加到 <code>Embedded Binaries</code> 中，并且默认自动添加到Link Binary With Libraries中）；其只支持主程序和扩展程序共用该动态库，其他应用还是无法进行公共，这和系统的（如UIKit.framework）还是有着很大区别的；</strong></p>

<p><img src="media/15210408337160/xcode_6.png" alt="xcode_6" style="width:300px;"/></p></li>
</ul></li>
<li><p><strong>Xcode 6（iOS8）发布了Swift 1.0，但是Swift不支持静态库（.a、.framework），只支持动态库（.tdb/.dylib、.framework）；从Xcode 9开始，Swift 4.0支持静态库；</strong></p></li>
<li><p>CocoaPods在纯ObjC项目中，默认将第三方库源码编译成.a静态库集成到项目中；若含有Swift的类库则必须添加 <code>use_frameworks!</code> 标识（纯ObjC项目中也可以使用的），进而生成.framework动态库；</p></li>
<li><p>Carthage只支持生成.framework动态库（原因：Carthage是通过Swift语言编写而成的），故其支持的项目最低版本为8.0；</p></li>
</ul>

<h4 id="toc_2">三、设备CPU架构</h4>

<ul>
<li><p>CPU架构</p>

<ul>
<li>a. 模拟器：iPhone 4s~5c为i386，iPhone 5s~...为x86_64；</li>
<li>b. 真机：iPhone 3gs~4s为armv7，iPhone 5~5c为armv7s，iPhone 5s~...为arm64；静态库只要支持armv7，就可以运行在armv7s架构上；</li>
</ul></li>
<li><p>生成库类型</p>

<ul>
<li>a. 通过修改Xcode编译的目标设备，可以分别生成模拟器、真机的库；</li>
<li>b. 通过修改Xcode编译的Scheme的config，可以分别生成Debug、Release的库；</li>
<li>c. Xcode在Debug、模拟器情况下，默认只会生成Active平台的CPU架构，比如生成的模拟器的库只有x86_64架构（通过 <code>lipo -info</code> 命令查看）；修改Build Settings的 <code>Build Active Architecture Only</code> 为No，则生成所有的CPU架构；真机情况下为armv7、arm64两种架构(armv7s被Apple舍弃了)；</li>
<li>d. 可以使用 <code>lipo -create</code> 命令合并相关的库文件；</li>
</ul></li>
<li><p>通用（合成）库类型</p>

<ul>
<li><strong>使用Xcode编译一次只会生成一种类型的库，可以使用 <code>Aggregate Target</code> 生成多种类型的合成库；</strong></li>
<li><p>新建 <code>Aggregate Target</code> ，添加 <code>Run Script</code> ，填入以下类似内容（参考<code>http://blog.csdn.net/qq_16706275/article/details/45913269</code>）：</p>

<pre><code class="language-text"># Sets the target folders and the final framework product.
# 如果工程名称和Framework的Target名称不一样的话，要自定义FMKNAME
# 例如: FMK_NAME = &quot;MyFramework&quot;
FMK_NAME=${PROJECT_NAME}

# Install dir will be the final output to the framework.
# The following line create it in the root folder of the current project.
INSTALL_DIR=${SRCROOT}/Products/${FMK_NAME}.framework

# Working dir will be deleted after the framework creation.
WRK_DIR=build
DEVICE_DIR=${WRK_DIR}/Release-iphoneos/${FMK_NAME}.framework
SIMULATOR_DIR=${WRK_DIR}/Release-iphonesimulator/${FMK_NAME}.framework

# -configuration ${CONFIGURATION}
# Clean and Building both architectures.
xcodebuild -configuration &quot;Release&quot; -target &quot;${FMK_NAME}&quot; -sdk iphoneos clean build
xcodebuild -configuration &quot;Release&quot; -target &quot;${FMK_NAME}&quot; -sdk iphonesimulator clean build

# Cleaning the oldest.
if [ -d &quot;${INSTALL_DIR}&quot; ]
then
rm -rf &quot;${INSTALL_DIR}&quot;
fi

mkdir -p &quot;${INSTALL_DIR}&quot;
cp -R &quot;${DEVICE_DIR}/&quot; &quot;${INSTALL_DIR}/&quot;

# Uses the Lipo Tool to merge both binary files (i386 + armv6/armv7) into one Universal final product.
lipo -create &quot;${DEVICE_DIR}/${FMK_NAME}&quot; &quot;${SIMULATOR_DIR}/${FMK_NAME}&quot; -output &quot;${INSTALL_DIR}/${FMK_NAME}&quot;

rm -r &quot;${WRK_DIR}&quot;
open &quot;${INSTALL_DIR}&quot;
</code></pre></li>
</ul></li>
</ul>

<h4 id="toc_3">四、资源文件处理</h4>

<ul>
<li><p>对于.a静态库</p>

<ul>
<li><p>a. 因为无法在.a文件中存放资源文件，需要将资源文件打包放在一个后缀为.bundle的文件夹中；</p></li>
<li><p>b. 使用时需要手动添加.bundle到主项目中，之后通过以下方式使用：</p>

<pre><code class="language-objectivec">[UIImage iamgeNamed:&quot;A.bundle/test.png&quot;];
</code></pre></li>
</ul></li>
<li><p>对于.framework静、动态库</p>

<ul>
<li><p>a. .framework文件本质上也是一个bundle文件；</p></li>
<li><p>b. 可以将资源文件直接（或打包成bundle后）放在.framework文件中，也可以将资源文件打包成bundle后与.framework文件独立开来；</p></li>
<li><p>c. <strong>需要注意的是：Xcode在添加.framework到项目中的时候，不会添加.framework中的资源文件到项目中（添加bundle会自动添加的），故无法其中的资源无法使用；必须在 <code>Copy Bundle Resources</code> 中添加对应的.framework</strong>，之后通过以下方式使用：</p>

<pre><code class="language-objectivec">// .framework中直接包含图片
[UIImage iamgeNamed:&quot;A.framework/test.png&quot;]
// .framework中还有bundle，bundle中包含图片
[UIImage iamgeNamed:&quot;A.framework/A.bundle/test.png&quot;]

// 路径
[[NSBundle mainBundle] pathForResource:@&quot;a.framework/a.bundle/test.png&quot; ofType:nil];
</code></pre></li>
<li><p>d. 一般情况下，建议将资源文件和framework分开使用；（参考<code>http://www.cocoachina.com/bbs/read.php?tid-1676834-page-2.html</code> 、<code>http://www.cnblogs.com/mylizh/p/3971428.html</code>）</p></li>
</ul></li>
<li><p>注意： </p>

<ul>
<li><p><strong>a. 对于无xib的资源可以直接新建文件夹后，修改后缀名为.bundle即可手动创建bundle文件；Bundle是静态的，故手动创建bundle文件的内部资源文件无法被编译；</strong></p></li>
<li><p>b. 对于有xib的资源，需要新建Bundle Target（选择macOS的Bundle Target，之后修改Build Setting -&gt; Base SDK为iOS；iOS没有该类型的Target），将xib添加到该Target后，编译运行将xib文本文件编译成nib二进制文件，最终创建bundle文件；</p></li>
<li><p>c. nib与xib的区别：nib是二进制文件，xib是xml文本文件，xib是用来替代nib的；当程序编译时将xib编译序列化（调用encodeWithCoder方法）为nib，使用时将nib反序列化（调用initWithCoder方法）为xib；</p></li>
</ul></li>
</ul>

<h4 id="toc_4">五、补充知识</h4>

<ul>
<li><p><strong>若需要边开发边调试类库：在现有工程中添加一个库Lib Target，设置一些相关配置（默认情况下自动添加，比如主Target的Build Phases的Target Dependencies添加lib Target、Embedded Binaries添加Lib、Link Binary With Libraries添加Lib、Public头文件、Copy Bundle Resources等），之后就可以进行调试；</strong></p></li>
<li><p>若静态库中使用了分类，则在使用时需要在 <code>other linker flags</code> 中增加 <code>-ObjC</code> 配置，否则报<code>selector not recognized</code>运行时错误；</p></li>
</ul>

      </div>

      <div class="row">
        <div class="large-6 columns">
          <p class="text-left" style="padding:15px 0px;">
            
            <a href="15219669294797.html" title="Previous Post: GitBook配置使用">&laquo; GitBook配置使用</a>
            
          </p>
        </div>
        <div class="large-6 columns">
          <p class="text-right" style="padding:15px 0px;">
            
            <a href="15206830265209.html" title="Next Post: Swift、ObjC混编">Swift、ObjC混编 &raquo;</a>
            
          </p>
        </div>
      </div>

      <div class="comments-wrap">
        <div class="share-comments">
            
        </div>
      </div>

    </div>
  </div> <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">

      <div id="site-info" class="site-info">
        
        <h1>TIME TO GO</h1>
        <div class="site-des">It is just a matter of time.</div>
        <div class="social">
                    
          <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
        </div>
      </div>

      

      <div id="site-categories" class="side-item ">
        <div class="side-header">
          <h2>Categories</h2>
        </div>
        <div class="side-content">
          <p class="cat-list">
            
          </p>
        </div>
      </div>

      <div id="site-categories" class="side-item">
        <div class="side-header">
          <h2>Recent Posts</h2>
        </div>
        <div class="side-content">
          <ul class="posts-list">
              <li class="post">
              <a href="15859991604863.html">多线程与GCD</a>
              </li>
                 <li class="post">
              <a href="15703760378326.html">NIB、XIB、StoryBoard与UIViewController、UIView</a>
              </li>
                 <li class="post">
              <a href="15626010144789.html">iOS状态栏</a>
              </li>
                 <li class="post">
              <a href="15622540495294.html">iOS屏幕方向</a>
              </li>
                 <li class="post">
              <a href="15590636648081.html">OpenCV配置使用</a>
              </li>
                                             
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>

</div> <div class="page-bottom clearfix">
  <div class="row">
    <p class="copyright">Copyright &copy; 2015 Powered by
      <a target="_blank" href="">ME</a>
    </p>
  </div>
</div>
</section>

</div>
</div>

 
<script src="asset/js/foundation.min.js"></script>
<script>
  $(document).foundation();
  function fixSidebarHeight() {
    var w1 = $('.markdown-body').height();
    var w2 = $('#sidebar').height();
    if (w1 > w2) { $('#sidebar').height(w1); };
  }
  $(function () {
    fixSidebarHeight();
  })
  $(window).load(function () {
    fixSidebarHeight();
  });
</script>   
</body>

</html>