<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
     Ubuntu使用教程 - TIME TO GO 
  </title>
   
  <link href="atom.xml" rel="alternate" title="TIME TO GO" type="application/atom+xml">
  <link rel="stylesheet" href="asset/css/foundation.min.css" />
  <link rel="stylesheet" href="asset/css/docs.css" />
  <script src="asset/js/vendor/modernizr.js"></script>
  <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
  <script type="text/javascript">
    function before_search() {
      var searchVal = 'site: ' + document.getElementById('search_input').value;
      document.getElementById('search_q').value = searchVal;
      return true;
    }
  </script>
</head>

<body class="antialiased hide-extras">
  <div class="marketing off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">


      <nav class="top-bar docs-bar hide-for-small" data-topbar>
        <section class="top-bar-section">
          <div class="row">
            <div style="position: relative;width:100%;">
              <div style="position: absolute; width:100%;">
                <ul id="main-menu" class="left">
                  
                  <li id="">
                    <a target="self" href="index.html">Home</a>
                  </li>
                  
                  <li id="">
                    <a target="_self" href="archives.html">Archives</a>
                  </li>
                  
                </ul>
                <ul class="right" id="search-wrap">
                  <li>
                    <form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
                      <input type="hidden" id="search_q" name="q" value="" />
                      <input tabindex="1" type="search" id="search_input" placeholder="Search" />
                    </form>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </nav>

      <nav class="tab-bar show-for-small">
        <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
          <span> &nbsp; TIME TO GO</span>
        </a>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li>
            <a href="index.html">HOME</a>
          </li>
          <li>
            <a href="archives.html">Archives</a>
          </li>
          <li>
            <a href="about.html">ABOUT</a>
          </li>
          <li>
            <label>Categories</label>
          </li>
          
        </ul>
      </aside>
      <a class="exit-off-canvas" href="#"></a>
      <section id="main-content" role="main" class="scroll-container"> <script type="text/javascript">
  $(function () {
    $('#menu_item_index').addClass('is_active');
    $('#sidebar').parent().parent().hide();
  });
</script>

<div class="row">
  <div class="large-12 medium-12 columns">
    <div class="markdown-body article-wrap">

      <div class="article">
        
        <h1>Ubuntu使用教程</h1>
        <div class="read-more clearfix">
          <span class="date">2018/8/11</span>
           
          <span class="comments">
             
          </span>
        </div>
      </div>

      <div class="article-content">
        <ul>
<li>
<a href="#toc_0">一、apt-get、存储空间管理</a>
</li>
<li>
<a href="#toc_1">二、内核管理</a>
</li>
<li>
<a href="#toc_2">三、系统时间</a>
</li>
<li>
<a href="#toc_3">四、MySQL安装</a>
</li>
<li>
<a href="#toc_4">五、域名解析</a>
</li>
<li>
<a href="#toc_5">六、服务管理</a>
</li>
<li>
<a href="#toc_6">七、Nginx安装</a>
</li>
</ul>


<h4 id="toc_0">一、apt-get、存储空间管理</h4>

<ul>
<li>概述

<ul>
<li>Linux软件包按封装类型分为：<strong>.deb</strong>（Debian/Ubuntu等系列使用）、<strong>.rpm</strong>（RedHat等系列使用）、Tarball源码压缩包（<strong>.tar.gz、.tar.bz2</strong>）；</li>
<li>软件仓库：存放软件包的地方；Ubuntu通过特定的命令（<code>apt-get</code>）就能完成软件的索引、安装、更新等操作，让相关步骤更简单、更安全；</li>
<li>软件依赖：安装的一个软件需要依赖其他的软件或某些函数，才能实现该软件的功能；使用<code>apt-get</code>维护软件时，其会自动识别下载并安装相应的依赖软件；</li>
<li>为了解决命令过于分散的问题，Ubuntu 16.04 引入了apt命令，其包括了apt-get中使用最广泛的功能选项，以及apt-cache、apt-config命令中很少用到的功能；<strong>简单来说，apt = apt-get + apt-cache + apt-config；可以用apt替换部分apt-get系列命令（不是全部，低级操作仍然需要apt-get）</strong>；</li>
</ul></li>
</ul>

<span id="more"></span><!-- more -->       

<ul>
<li><p>apt-get命令</p>

<pre><code class="language-shell">// 安装软件（会自动安装依赖软件）
apt-get install XXX

// 若安装软件时，发现安装的其他软件包不兼容可能导致安装出错时，
// 可以根据以下命令解决此问题
apt-get install -f
</code></pre>

<pre><code class="language-shell">// 更新软件源中的索引记录
//（/etc/apt/sources.list配置了软件源）
apt-get update
// 更新软件
apt-get upgrade XXX
</code></pre>

<pre><code class="language-shell">// 卸载软件，不会卸载依赖软件（保留配置文件）
apt-get remove XXX
// 卸载软件，不会卸载依赖软件（不保留配置文件）
apt-get &lt;remove --purge | purge&gt; XXX 

// 卸载软件及不再需要的依赖软件（保留配置文件）
apt-get autoremove XXX
// 卸载软件及不再需要的依赖软件（不保留配置文件）
apt-get autoremove --purge XXX
// 卸载系统不再使用的孤立软件 
apt-get autoremove --purge
</code></pre>

<pre><code class="language-shell">// 查询相关的软件安装卸载状态
dpkg --get-selection | grep XXX
</code></pre>

<pre><code class="language-shell">// apt-get的底层是dpkg，而dpkg安装包时会将*.deb放在/var/cache/apt/archives/中
// 删除/var/cache/apt/archives/中所有deb
apt-get clean
// 删除/var/cache/apt/archives/中已过期的deb
apt-get autoclean
</code></pre></li>
<li><p>存储空间管理命令</p>

<pre><code class="language-shell">// 查看磁盘空间使用状况
df -h

// 查看当前目录内中的文件目录的使用大小
du -h --max-depth=1 

// 查看/root目录内中的文件目录的使用大小
du -h --max-depth=1 /root
</code></pre></li>
</ul>

<h4 id="toc_1">二、内核管理</h4>

<ul>
<li><p>清理多余的Linux内核</p>

<ul>
<li><p>当系统升级的时，旧的内核版本并不会被清理，之后就会导致/boot空间不足；卸载旧的内核版本可解决此问题；</p>

<pre><code class="language-shell">// 查看系统已经安装的内核版本
// 状态install说明已安装的版本
dpkg --get-selections | grep linux
dpkg --list | grep linux

// 查看系统当前使用的内核版本
uname -r
</code></pre>

<pre><code class="language-shell">// 使用purge命令删除相应的内核
// Ubuntu内核镜像包含: linux-headers-(内核头文件)、linux-image-(内核镜像)、linux-image-extra-（额外的内核模块）
apt-get purge linux-image-4.4.0-103-generic
// 或
apt-get purge linux-image-4.4.0*

// 若删除时，出现类似以下错误
// “linux-headers-generic : Depends: linux-headers
// -XXX-generic but it is not going to be installed”
// 进入/boot目录，将把4.4.0版本的config-4.4.0-*、vmlinuz-4.4.0-*、
// initrd.img-4.4.0-*、abi-4.4.0-*、System.map-4.4.0-*、retpoline-4.4.0-*都删除
// 然后执行apt-get install -f命令进行修复
// 最后，再次使用purge命令删除相应的内核

// 若GRUB配置在删除旧内核后没有正确升级，执行以下命令更新配置
update-grub2 或 update-grub

清理/usr/src目录，删除已经卸载的内核目录
</code></pre></li>
</ul></li>
<li><p>升级Linux内核</p>

<pre><code class="language-shell">uname -r

apt-get update

// 查看可用的Linux内核版本
apt-cache showpkg linux-image

// 安装想要升级的Linux内核版本，如inux-image-4.10.0-22-generic
apt-get install linux-image-4.10.0-22-generic

// 更新GRUB
update-grub

// 安装完成后重启
sudo reboot
</code></pre></li>
</ul>

<h4 id="toc_2">三、系统时间</h4>

<ul>
<li>格林尼治标准时：GMT，Greenwish Mean Time，指位于伦敦郊区的皇家格林尼治天文台（本初子午线）的标准时间，因为地球自转的速度是不均衡的，该时间不够精确；</li>
<li>协调世界时：UTC，Coordinated Universal Time ，基于原子物理学的特性，更加精确基本不会产生误差，被应用在互联网标准中；</li>
<li><p><strong>基本上可以认为GMT=UTC，例如北京时间=UTC+8=GMT+8；</strong></p>

<pre><code class="language-shell">// 查看当前系统时间
date -R   

// 执行以下命令，按提示操作，修改时区到UTC
dpkg-reconfigure tzdata

// 同步网络时间
apt-get install ntpdate // 安装ntpdate工具
ntpdate cn.pool.ntp.org

// 将时间写入硬件（防止重启时间被还原）
hwclock --systohc
</code></pre></li>
</ul>

<h4 id="toc_3">四、MySQL安装</h4>

<ul>
<li><p>MySQL的安装可以通过apt、.deb离线安装包、tar.gz压缩包三种方式进行安装；其中通过tar.gz压缩包进行安装，需要手动配置启动服务、环境变量等操作，而且其他两种方式则会自动配置所需要的；</p></li>
<li><p>安装步骤</p>

<ul>
<li><p>a. 安装mysql</p>

<ul>
<li><strong>会自动安装mysql-server、mysql-server-core、mysql-client等相关包，且默认安装完成就启动了mysql</strong></li>
<li><p><strong>注意：在Ubuntu 18.0.4中安装mysql 5.7，不会像之前的版本会在安装过程中提示设置密码</strong></p>

<pre><code class="language-shell">apt-get install mysql-server 
</code></pre></li>
</ul></li>
<li><p>b. 配置mysql</p>

<ul>
<li>注意：若选择了安装“Validate Password Plugin”，这个设置的密码必须符合一定的安全要求；</li>
<li><p><strong>Note that even though you’ve set a password for the root MySQL user, this user is not configured to authenticate with a password when connecting to the MySQL shell.</strong></p>

<pre><code class="language-shell">mysql_secure_installation 
</code></pre></li>
</ul></li>
<li><p>c. 调整用户认证方式（可选）</p>

<ul>
<li><strong>在Ubuntu 18.0.4中安装mysql 5.7，mysql的root用户默认使用<code>auth_socket plugin</code>去认证而不是密码，这导致在终端中直接<code>mysql -uroot</code>不用密码就能登陆（即使在<code>配置mysql</code>中设置了密码也没有效果）</strong></li>
<li><p>In Ubuntu systems running MySQL 5.7 (and later versions), the root MySQL user is set to authenticate using the auth_socket plugin by default rather than with a password. This allows for some greater security and usability in many cases, but it can also complicate things when you need to allow an external program (e.g., phpMyAdmin) to access the user.（参考<code>https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-18-04</code>）</p>

<pre><code class="language-sql">SELECT user,authentication_string,plugin,host FROM mysql.user;

ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;password&#39;;
FLUSH PRIVILEGES;

SELECT user,authentication_string,plugin,host FROM mysql.user;
</code></pre></li>
</ul></li>
<li><p>d. 开启远程访问（可选）</p>

<pre><code class="language-shell">**默认情况下mysql只允许本地连接访问；**

// 开启远程访问
nano /etc/mysql/mysql.conf.d/mysqld.cnf，
将bind-address = 127.0.0.1注释

// 授权用户(没有该用户就创建)
// 也可以授权给root用户，但是和mysql安装时创建的root是两条记录
GRANT ALL PRIVILEGES ON *.* TO &#39;username&#39;@&#39;%&#39; IDENTIFIED BY &#39;password&#39; WITH GRANT OPTION;
SELECT user,authentication_string,plugin,host FROM mysql.user;
</code></pre></li>
</ul></li>
<li><p>管理命令</p>

<pre><code class="language-shell">// 检查MySQL是否运行
netstat -tap | grep mysql
service mysql status
systemctl status mysql
systemctl status mysql.service

// 重启/打开/关闭MySQL
service mysql restart/start/stop
systemctl restart/start/stop mysql 
systemctl restart/start/stop mysql.service 
</code></pre></li>
</ul>

<h4 id="toc_4">五、域名解析</h4>

<ul>
<li><p>A记录</p>

<ul>
<li>用于指定域名对应的IP地址；</li>
<li>适应于独立主机、有固定IP地址；</li>
<li>相同域名下的子域名也可以对应不同的IP地址，比如<code>www.domain1.com-&gt;1.1.1.1、ftp.domain1.com-&gt;2.2.2.2</code>；</li>
<li>不同域名下的子域名也可以对应相同的IP地址，比如<code>www.domain1.com-&gt;1.1.1.1、www.domain2.com-&gt;1.1.1.1</code>；</li>
<li>泛域名解析：<code>主机名</code>中填入<code>*</code>，这样该域名所有未指定的子域名都对应该IP地址；</li>
<li>负载均衡（Server Load Balancing，SLB）：相同域名配置多个不同的IP地址，轮循访问；</li>
</ul></li>
<li><p>AAAA记录：</p>

<ul>
<li>IPv6版的A记录，对应的IP地址为IPv6地址；</li>
</ul></li>
<li><p>CNAME记录（Canonical Name，别名记录）</p>

<ul>
<li>用于指定域名对应的其他域名；</li>
<li>适应于虚拟主机、变动IP地址主机；</li>
<li>可以将相同域名下的子域名先对应一个域名下，然后再对该域名添加一个A记录，比如<code>www.domain1.com-&gt;host.domain1.com、ftp.domain1.com-&gt;host.domain1.com、host.domain1.com-&gt;1.1.1.1</code>；当然也可以直接添加多个A记录，但是当IP地址变动时需要修改所有的A记录，而使用上面的方式只需要修改那个唯一的A记录；</li>
</ul></li>
<li><p>MX记录（Mail Exchange，邮件路由记录）</p>

<ul>
<li>用于指定邮件路由请求对应的IP地址或域名；</li>
</ul></li>
<li><p>URL转发（(Uniform Resource Locator）</p>

<ul>
<li>不属于域名解析，重定向一个域名到另一个域名，使用HTTP 301状态码；类型还分显式和隐式；</li>
<li>适应于更换域名又不想抛弃老用户；</li>
<li>URL转发与CNAME记录的区别：URL转发可以转发到某个目录及文件上，CNAME记录不可以；</li>
</ul></li>
<li><p>TTL值</p>

<ul>
<li>解析记录在DNS服务器中的缓存时间，单位为秒，一般为3600秒；</li>
<li>若缓存过期了，才会NS服务器进行请求；</li>
</ul></li>
<li><p>NS记录（Name Server）</p>

<ul>
<li>域名服务器记录，用于指定该域名由哪个NS服务器来进行解析，就是要在哪个NS服务器对应的管理后台配置上述的A记录、CNAME记录等；</li>
</ul></li>
</ul>

<h4 id="toc_5">六、服务管理</h4>

<ul>
<li><p>Linux服务有/etc/init.d、service、systemctl三种方式管理；</p>

<ul>
<li><p>a. <code>/etc/init.d/XXX start/stop/...</code></p>

<ul>
<li>到/etc/init.d目录执行相关程序；</li>
<li><strong>缺点：启动时间长（init进程是串行启动）、启动脚本复杂（脚本中需要处理各种case）；</strong></li>
<li>一般常用软件的脚本都已编写好，不需要再编写，但其他软件需要自己编写；</li>
</ul>

<pre><code class="language-shell">/etc/init.d/mysql start
</code></pre></li>
<li><p>b. <code>service XXX start/stop/...</code></p>

<ul>
<li>其实本质就是/etc/init.d，也是到/etc/init.d目录执行相关程序；</li>
</ul>

<pre><code class="language-shell">service mysql start
</code></pre></li>
<li><p>c. <code>systemctl start/stop/... XXX</code></p>

<ul>
<li>systemctl是systemd的主命令，用于管理系统及进程；</li>
<li>systemd是Linux系统最新的初始化系统（init），用于提高系统的启动速度；systemd是一组命令，其还包括systemd-analyze（查看启动耗时）、hostnamectl（查看当前主机的信息）等命令；</li>
<li><strong>systemctl需要的服务脚本（.service类型的systemd的Unit）更简洁，只需要配置执行文件、pid文件路径等即可；</strong></li>
</ul>

<pre><code class="language-shell">systemctl start mysql
systemctl start mysql.service
</code></pre></li>
</ul></li>
<li><p>systemctl作用</p>

<ul>
<li><strong>a. systemctl管理着systemd的Unit，主要有四种类型文件：.mount、.target、.wants、.service；</strong>

<ul>
<li>.mount定义一个挂载点，[Mount]节点里配置What、Where、Type三个数据项；</li>
<li>.target定义一些基础的组件，以供.service调用；</li>
<li>.wants定义要执行的文件集合，每次执行时，.wants文件夹里面的文件都会执行；</li>
<li>.service定义了一个服务，分为[Unit]、[Service]、[Install]三个小节；</li>
<li>Ubuntu的systemd的Unit在<code>/etc/systemd/system</code>，Centos的在<code>/usr/lib/systemd/system</code>；</li>
</ul></li>
<li><strong>b. systemctl也兼容了service，也会去/etc/init.d目录查找执行相关程序；</strong></li>
</ul></li>
</ul>

<h4 id="toc_6">七、Nginx安装</h4>

<ul>
<li><p>Nginx是一个免费的开源高性能服务器，其有以下主要功能：<strong>静态HTTP服务器、<br/>
反向代理服务器、负载均衡、虚拟主机等，其中负载均衡、虚拟主机是基于反向代理实现的</strong>；（参考<code>http://xxgblog.com/2015/05/17/nginx-start/</code>）</p>

<ul>
<li>a. Nginx可以将服务器上的静态文件（如HTML、图片）通过HTTP协议返回给客户端；</li>
<li>b. 客户端本来可以直接访问某网站的应用服务器，若在这中间加上Nginx，则客户端先请求Nginx，Nginx再请求应用服务器，此时Nginx就是反向代理服务器；</li>
<li><strong>c. 当网站访问量非常大时，可以将相同的应用部署在多台服务器上，使用Nginx反向代理，让大量用户的请求分配给多台机器处理，实现负载均衡；</strong></li>
<li><strong>d. 网站访问量大需要负载均衡，网站访问量小，为节省成本，可以将多个网站部署在同一台服务器上（通过配置文件中的<code>server_name</code>来区分）；</strong>如将www.aaa.com、www.bbb.com两个网站部署在同一台服务器上，两个域名解析到同一个IP，但用户通过两个域名却打开两个完全不同的网站，互相不影响，就像访问两个服务器一样，所以叫两个<code>虚拟主机</code>；</li>
</ul></li>
<li><p>安装</p>

<pre><code class="language-shell">apt install nginx

nginx -v
systemctl status nginx

// reload重新加载配置文件，服务不中断
// enable开机自启动
systemctl start|stop|restart|reload|enable|disable nginx
</code></pre>

<ul>
<li>文件目录位置：<code>/usr/sbin/nginx（主程序</code>）、<code>/etc/nginx（存放配置文件）</code>、<code>/var/log/nginx（存放日志）</code>、<code>/usr/share/nginx（存放静态文件）</code>；<strong>Nginx默认加载<code>/etc/nginx/nginx.conf</code>配置文件；</strong></li>
<li><strong>Linux系统的运行程序一般放在/usr/sbin或/usr/bin，配置文件一般放在/etc，日志一般放在/var/log；</strong></li>
</ul></li>
<li><p>静态网页与动态网页</p>

<ul>
<li><p>协议规范</p>

<ul>
<li>Web Server只是简单地响应浏览器发来的HTTP请求，并将存储在服务器上的HTML文件（静态HTML）返回给浏览器；</li>
<li>Web Server并不能直接运行动态网页（如php、jsp、asp、python等），而是需要让第三方程序处理；其把请求参数（如CONTENT_TYPE、QUERY_STRING等）发送给第三方，然后第三方将处理结果返回回来；<strong>Web Server与第三方程序的数据交互规范称为<code>CGI（Common Gateway Interface）</code></strong>；（参考：CGI、FastCGI和PHP-FPM关系图解<code>https://www.awaimai.com/371.html</code>）</li>
<li><strong>CGI只是接口协议，有多种语言实现；</strong>CGI对于每次Web Server的请求都会生成新的进程进行处理，处理完毕后就立即销毁，效率低；</li>
<li>为了解决CGI的问题，产生了FastCGI；<strong><code>FastCGI</code>像是一个常驻型（long-live）的CGI，会同时生成和回收多个CGI进程，以内存空间换取处理时间；</strong></li>
<li><code>SCGI（Simple Common Gateway Interface）</code>也是CGI的替代版本；</li>
<li><code>WSGI（Web Server Gateway Interface）</code>是Python的专有协议，作用与CGI、FastCGI、SCGI一样；运行在该协议之上的web框架有Django、Flask、Bottle;</li>
<li><code>uwsgi</code>是一种作用和WSGI一样的通信协议，该协议是uWSGI服务器的独占协议；</li>
</ul></li>
<li><p>协议实现</p>

<ul>
<li><strong><code>PHP-FPM</code>是一个针对于PHP的FastCGI实现</strong>，同时也额外提供以一些功能；</li>
<li><strong><code>uWSGI</code>是一个Web服务器，同时实现了WSGI、uwsgi、HTTp等协议</strong>，使用C编写，效率高性能稳定，支持Python、Ruby、Go等；</li>
</ul></li>
<li><p>Web Server</p>

<ul>
<li>Nginx是一个Web Server，需要通过以下配置指令<code>fastcgi_pass</code>、<code>scgi_pass</code>、<code>uwsgi_pass</code>与FastCGI的实现、SCGI的实现、uwsgi的实现进行交互；</li>
<li>Apache也是一个Web Server，但是可以通过<strong>Module加载（另一种Web Server与第三方程序的数据交互的方式）</strong>的方式支持PHP；</li>
<li>Tomcat是Apache的一个子项目，一个动态网页处理容器，但是同时也支持web服务器的功能；<strong>一般情况下使用Apache处理静态网页，使用Tomcat处理动态网页；</strong></li>
</ul></li>
</ul></li>
<li><p>nginx.conf文件结构</p>

<pre><code class="language-shell"># 全局块
events { # events块
    ...
}

http { # http块

    server { # server块
        location [PATTERN] { # location块
            ...
        }
        location [PATTERN] { # location块
            ...
        }
        ...
    }

    server { # server块
        location [PATTERN] { # location块
            ...
        }
        location [PATTERN] { # location块
            ...
        }
        ...
    }

    ...
}

... # 其他块
</code></pre>

<ul>
<li><code>全局块</code>：配置影响nginx全局的指令；比如运行nginx的用户组、进程pid存放路径、日志存放路径、配置文件引入、允许生成worker process数等；</li>
<li><code>events块</code>：配置影响nginx与用户的网络连接；比如每个进程的最大连接数、事件驱动模型、是否允许同时接受多个网络连接、多个网络连接序列化等；</li>
<li><code>http块</code>：可以配置多个server、配置代理、缓存、日志定义、第三方模块等；</li>
<li><code>server块</code>：配置虚拟主机的相关参数，一个http中可以配置多个server；</li>
<li><code>location块</code>：配置请求的路由、及各种页面的处理情况，一个server中可以配置多个location；</li>
</ul></li>
<li><p>nginx.conf文件举例</p>

<pre><code class="language-shell">#user root root; # 用户或者组，默认为nobody nobody
#worker_processes 2; # 允许生成的进程数，默认为1
#pid /nginx/pid/nginx.pid; # nginx进程运行文件存放地址
error_log log/error.log debug;  # 错误日志路径及级别；该设置可放入全局块、http块、server块，
# 级别为debug、info、notice、warn、error等

events {
    accept_mutex on; # 设置网路连接序列化，默认为on
    multi_accept on; # 设置一个进程是否同时接受多个网络连接，默认为off
    #use epoll; # 事件驱动模型，可以设置为select、poll、epoll等
    worker_connections 1024; # 最大连接数
}

http {
    include mime.types; # 文件扩展名与文件类型映射表
    default_type  application/octet-stream; # 默认文件类型，默认为text/plain

    access_log on; # 开启服务日志
    # 自定义日志格式
    log_format myFormat &#39;$remote_addr $time_local $request $status $http_user_agent&#39;;
    access_log log/access.log myFormat; # 设置访问日志路径及格式

    keepalive_timeout 60; # 连接超时时间，该设置可放入http，server，location块。

    upstream mysvr {   
      server 192.168.1.1:8080;
      server 192.168.1.2:8888 backup;
    }

    error_page 404 /404.html; # 404页

    server { # 配置一个虚拟服务器
        keepalive_requests 120; # 单连接请求次数上限
        listen 4545; # 监听端口 
        server_name example.com www.example.com;
        # 请求url正则匹配，~为区分大小写，~*为不区分大小写
        location  ~*^.+$ {
           #root path;  # 根目录
           #index index.html; # 默认页
           deny 192.168.1.3; # 拒绝访问的ip
           allow 192.168.1.4; # 允许访问的ip           
        }
    }

}
</code></pre>

<ul>
<li><p>常见日志参数：</p>

<ul>
<li>$remote_addr：客户端的ip地址 </li>
<li>$remote_user：客户端用户名称 </li>
<li>$time_local 访问时间与时区</li>
<li>$request：请求的url与http协议</li>
<li>$status：请求状态，成功为200；</li>
<li>$http_user_agent：客户端agent</li>
<li>$query_string：GET请求的查询参数</li>
</ul></li>
<li><p>指令分类根据其形式可分为两种类型：</p>

<ul>
<li>a. 简单指令：由指令名和参数组成，必须以分号结尾；如user、root、index等；</li>
<li>b. 复合指令（块指令）：包含一对大括号，其中又可以嵌套其它指令，如events、http、server、location等指令；</li>
</ul></li>
<li><p><strong>server：http中可以配置多个server，比如，一个监听80端口，用于处理http请求，另一个监听443端口，用于处理https请求；</strong></p></li>
<li><p><strong>server_name：应用场景，多个域名建多个网站时，但只有一台服务器，可以配置多个server（监听相同的IP和端口），而配置不同的server_name，从而实现多个网站共用一台服务器；</strong></p></li>
<li><p>root：指定网站根目录，可在server、location中配置（里层location配置的会覆盖server配置的）；</p></li>
<li><p>index：用于指定index文件，可在server、location中配置（里层location配置的会覆盖server配置的）；</p></li>
<li><p>location：指定匹配请求路径（request path）；</p></li>
</ul></li>
<li><p>Nginx配置案例</p>

<pre><code class="language-shell"># 静态HTTP
server {
    listen 80;
    location / {
        root /usr/html; # 静态文件路径
    }
}

# 反向代理
server {
    listen 80;
    location / {
        proxy_pass http://192.168.1.1:8080; # 应用服务器HTTP地址
    }
}

# 负载均衡
upstream myapp {
    server 192.168.0.1:8080; # 应用服务器1
    server 192.168.0.2:8080; # 应用服务器2
}
server {
    listen 80;
    location / {
        proxy_pass http://myapp;
    }
}

# 虚拟主机
server {
    listen 80 default_server;
    server_name _;
    return 444; # 过滤其他域名的请求，返回444状态码
}
server {
    listen 80;
    server_name www.aaa.com; # www.aaa.com域名
    location / {
        proxy_pass http://localhost:8080; # 对应端口号8080
    }
}
server {
    listen 80;
    server_name www.bbb.com; # www.bbb.com域名
    location / {
        proxy_pass http://localhost:8081; # 对应端口号8081
    }
}

# FastCGI
server {
    listen 80;
    location ~\.php$ {
        include fastcgi_params;
        fastcgi_pass 127.0.0.1:9000;
        # 传递一些参数信息（可选）
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; #PHP文件路径
    }
}

# uWSGI
server {
    listen 80;
    location $ {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:9090;
        # 传递一些参数信息（可选）
        # uwsgi_param UWSGI_PYHOME /var/www/myenv;
    }
}
</code></pre></li>
</ul>

      </div>

      <div class="row">
        <div class="large-6 columns">
          <p class="text-left" style="padding:15px 0px;">
            
          </p>
        </div>
        <div class="large-6 columns">
          <p class="text-right" style="padding:15px 0px;">
            
            <a href="15332159757050.html" title="Next Post: 证书、SSL、HTTPS">证书、SSL、HTTPS &raquo;</a>
            
          </p>
        </div>
      </div>

      <div class="comments-wrap">
        <div class="share-comments">
            
        </div>
      </div>

    </div>
  </div> <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">

      <div id="site-info" class="site-info">
        
        <h1>TIME TO GO</h1>
        <div class="site-des">It is just a matter of time.</div>
        <div class="social">
                    
          <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
        </div>
      </div>

      

      <div id="site-categories" class="side-item ">
        <div class="side-header">
          <h2>Categories</h2>
        </div>
        <div class="side-content">
          <p class="cat-list">
            
          </p>
        </div>
      </div>

      <div id="site-categories" class="side-item">
        <div class="side-header">
          <h2>Recent Posts</h2>
        </div>
        <div class="side-content">
          <ul class="posts-list">
              <li class="post">
              <a href="15339807662944.html">Ubuntu使用教程</a>
              </li>
                 <li class="post">
              <a href="15332159757050.html">证书、SSL、HTTPS</a>
              </li>
                 <li class="post">
              <a href="15327896998795.html">Python中的常见问题</a>
              </li>
                 <li class="post">
              <a href="15288255574523.html">Python3笔记(19实战)</a>
              </li>
                 <li class="post">
              <a href="15285683833705.html">错误、异常的处理（Java、ObjC、Swift）</a>
              </li>
                                             
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>

</div> <div class="page-bottom clearfix">
  <div class="row">
    <p class="copyright">Copyright &copy; 2015 Powered by
      <a target="_blank" href="">ME</a>
    </p>
  </div>
</div>
</section>

</div>
</div>

 
<script src="asset/js/foundation.min.js"></script>
<script>
  $(document).foundation();
  function fixSidebarHeight() {
    var w1 = $('.markdown-body').height();
    var w2 = $('#sidebar').height();
    if (w1 > w2) { $('#sidebar').height(w1); };
  }
  $(function () {
    fixSidebarHeight();
  })
  $(window).load(function () {
    fixSidebarHeight();
  });
</script>   
</body>

</html>